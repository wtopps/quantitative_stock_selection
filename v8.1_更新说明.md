# A股选股脚本 v8.1 更新说明

## 🎉 本次更新内容

### 核心优化：历史记录功能增强

原先的"查看历史选股记录"（菜单选项6）仅能列出所有批次，无法深入分析。

**v8.1 新增功能：**

1. **二级菜单选择**
   - 查看历史记录后，可以输入序号选择具体批次
   - 支持连续查看多个批次
   - 输入0返回主菜单

2. **批次回测对比分析**
   - 显示该批次的选股时间、目标板块、股票数量
   - 自动获取当前最新股价
   - 计算每只股票的次日涨幅（如果有历史数据）
   - 计算累计涨跌幅（从选股价到当前价）
   - 展示今日涨跌幅

3. **多维度统计报告**
   - **个股表现明细**：按累计涨幅排序，展示每只股票的表现
   - **分评级统计**：AAA/AA/A等不同评级的平均表现和胜率
   - **整体表现统计**：次日平均涨幅、累计平均涨幅、最大盈利/亏损、胜率
   - **策略有效性评估**：根据整体表现给出策略评价建议

## 📖 使用方法

### 步骤 1: 运行脚本
```bash
python scan_stock_v8.py
```

### 步骤 2: 选择菜单选项 6
```
请选择操作:
  1. 全市场筛选（默认）- 自动回测上次结果
  2. 指定板块/概念筛选 - 自动回测上次结果
  3. 查看所有概念板块
  4. 查看所有行业板块
  5. 查看全年主题日历
  6. 查看历史选股记录 🆕 [支持选择批次回测对比]  ← 选这个
  7. 查看周选股记录

请输入选项: 6
```

### 步骤 3: 查看历史记录列表
系统会展示所有历史选股批次：
```
📚 【历史选股记录】v8.1

共有 10 条历史记录:

序号   批次ID               选股时间               板块         股票数
----------------------------------------------------------------------
1      20260114_143022     2026-01-14 14:30:22   全市场           15
2      20260113_093015     2026-01-13 09:30:15   人工智能          8
3      20260112_150330     2026-01-12 15:03:30   新能源           12
...
```

### 步骤 4: 输入序号查看批次详情
```
💡 输入序号查看该批次详情并对比当前股价 (输入0返回): 1
```

### 步骤 5: 查看回测分析报告
系统会自动：
1. 获取该批次所有股票的当前价格
2. 计算次日涨幅和累计涨幅
3. 生成详细的回测报告

示例输出：
```
【指定批次选股回测分析】v8.1
======================================================================

📅 选股时间: 2026-01-14 14:30:22
🔖 批次ID: 20260114_143022
🎯 目标板块: 全市场
📊 选出股票数: 15

⏳ 正在获取 15 只股票的最新行情...

------------------------------------------------------------
📈 【回测结果详情】
------------------------------------------------------------

📋 个股表现明细:
代码     名称     评级         次日涨幅     累计涨幅     今日涨幅
----------------------------------------------------------------------
300750   宁德时代  AAA(极强)      +3.45%      +8.23%      +1.12% 🔥
600519   贵州茅台  AA(强势)       +2.10%      +5.67%      -0.34% 📈
...

------------------------------------------------------------
📊 【分评级统计】
------------------------------------------------------------
   AAA(极强): 5只 | 次日均涨: +2.85% | 累计均涨: +6.12% | 胜率: 80.0%
   AA(强势): 7只 | 次日均涨: +1.56% | 累计均涨: +3.45% | 胜率: 71.4%
   A(良好): 3只 | 次日均涨: +0.89% | 累计均涨: +1.23% | 胜率: 66.7%

------------------------------------------------------------
📈 【整体表现统计】
------------------------------------------------------------
   次日平均涨幅: +1.89%
   次日上涨比例: 73.3%
   累计平均涨幅: +4.56%
   最大盈利: +12.34%
   最大亏损: -2.11%
   累计胜率: 73.3%

------------------------------------------------------------
💡 【策略有效性评估】
------------------------------------------------------------
   ✅ 策略表现优秀！建议继续使用当前筛选逻辑

   💎 AAA级标的表现: 平均涨幅 +6.12%
      → AAA级标的跑赢整体，评级系统有效
```

### 步骤 6: 继续或返回
查看完一个批次后，可以选择：
- 输入 `y` 继续查看其他批次
- 输入 `n` 或直接回车返回主菜单

## 🎯 应用场景

### 1. 验证选股策略有效性
- 定期查看历史批次的表现
- 观察不同市场环境下的策略胜率
- 评估AAA/AA/A等不同评级的准确性

### 2. 优化选股参数
- 对比不同板块的选股效果
- 找出表现最好的选股时机
- 调整筛选条件以提高胜率

### 3. 风险管理
- 了解策略的最大回撤
- 评估平均盈亏比
- 制定合理的止损止盈策略

### 4. 学习和改进
- 分析成功股票的共同特征
- 研究失败案例的原因
- 持续优化选股逻辑

## 📊 关键指标说明

| 指标 | 说明 |
|------|------|
| **次日涨幅** | 选股后第一个交易日的涨跌幅 |
| **累计涨幅** | 从选股价格到当前价格的总涨跌幅 |
| **胜率** | 盈利股票数 / 总股票数 |
| **平均涨幅** | 所有股票涨跌幅的算术平均值 |
| **最大盈利** | 单只股票的最大涨幅 |
| **最大亏损** | 单只股票的最大跌幅 |

## ⚠️ 注意事项

1. **次日涨幅数据**
   - 需要历史K线数据支持
   - 如果选股日期是非交易日，可能无法获取次日数据
   - 显示"N/A"表示数据不可用

2. **累计涨幅计算**
   - 基于选股时的价格和当前价格
   - 如果股票停牌或退市，可能无法获取当前价格

3. **策略评估**
   - 短期表现不代表长期有效性
   - 需要结合市场环境综合判断
   - 建议积累多个批次数据后再下结论

4. **数据时效性**
   - 回测分析使用的是实时行情数据
   - 不同时间查看同一批次，结果可能不同

## 🚀 后续优化方向

- [ ] 支持批量对比多个批次
- [ ] 导出回测报告到Excel
- [ ] 增加图表可视化展示
- [ ] 支持自定义回测周期（3日、7日、30日）
- [ ] 添加策略组合对比功能

## 📞 问题反馈

如有任何问题或建议，请提交Issue或联系开发者。

---

**版本**: v8.1
**更新日期**: 2026-01-14
**兼容性**: 完全兼容 v8.0 历史数据
